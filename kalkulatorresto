<!DOCTYPE html>
<html lang="bg">
<head>
<meta charset="UTF-8">
<title>–ï–≤—Ä–æ-–ö–∞—Å–∞ 2026 ‚Äì –£–Ω–∏–≤–µ—Ä—Å–∞–ª–Ω–∞</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<style>
:root{
  --primary:#00264d; --accent:#d4af37; --bg:#f2f2f2; --error:#dc3545; --ok:#28a745; --warn:#ffc107;
  --eur:#28a745; --bgn:#007bff;
  --btn-h:56px; --font-size:20px;
}
*{box-sizing:border-box;}
body{margin:0;font-family:-apple-system,Segoe UI,Roboto,Helvetica;font-size:16px;background:var(--bg);display:flex;justify-content:center;padding:8px}
.container{background:#fff;border-radius:12px;box-shadow:0 4px 20px rgba(0,0,0,.15);width:100%;max-width:480px;padding:16px}
h2{margin:0 0 12px;text-align:center;color:var(--primary);font-size:22px}
.info-banner{background:#e3f2fd;border:1px solid #90caf9;border-radius:8px;padding:10px;text-align:center;font-size:13px;margin-bottom:12px;color:#1565c0}
label{font-weight:600;font-size:12px;display:block;margin-bottom:4px}
input[type=number]{width:100%;font-size:var(--font-size);padding:12px;border:2px solid var(--border);border-radius:6px;text-align:right}
.eur-input{border-color:var(--eur);background:#f0fff4}
.bgn-input{border-color:var(--bgn);background:#f0f8ff}
.quick-calc{display:grid;grid-template-columns:repeat(3,1fr);gap:6px;margin:10px 0}
.quick-btn{height:var(--btn-h);border:2px solid;border-radius:6px;background:#fff;font-size:15px;font-weight:600;cursor:pointer;transition:.15s}
.quick-btn.eur{border-color:var(--eur);color:var(--eur)}
.quick-btn.eur:hover{background:var(--eur);color:#fff}
.quick-btn.bgn{border-color:var(--bgn);color:var(--bgn)}
.quick-btn.bgn:hover{background:var(--bgn);color:#fff}
.result-zone{background:var(--primary);color:#fff;padding:16px;border-radius:8px;text-align:center;margin:12px 0}
.result-value{font-size:38px;font-weight:bold;color:var(--accent)}
.change-toggle{display:flex;justify-content:center;gap:8px;margin:8px 0}
.change-toggle button{flex:1;padding:10px;border:2px solid #fff;border-radius:6px;background:transparent;color:#fff;font-weight:600;cursor:pointer}
.change-toggle button.active{background:#fff;color:var(--primary)}
.button-group{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-top:12px}
button{padding:14px;border:none;border-radius:6px;font-size:15px;font-weight:600;cursor:pointer}
.btn-save{background:var(--ok);color:#fff}
.btn-print{background:var(--primary);color:#fff}
.btn-cancel{background:var(--error);color:#fff}
button:disabled{opacity:.5;cursor:not-allowed}
.error-banner,.ok-banner{padding:10px;border-radius:6px;text-align:center;font-weight:600;margin:8px 0;display:none}
.error-banner{background:#f8d7da;color:#721c24;border:1px solid #f5c6cb}
.ok-banner{background:#d4edda;color:#155724;border:1px solid #c3e6cb}
.history-table{width:100%;font-size:11px;border-collapse:collapse;margin-top:10px}
.history-table th,.history-table td{border:1px solid #ddd;padding:6px;text-align:center}
.history-table th{background:var(--primary);color:#fff}
.stat-panel{background:#f8f9fa;border-radius:8px;padding:10px;margin-top:10px;font-size:13px}
.stat-item{display:flex;justify-content:space-between;padding:4px 0;border-bottom:1px solid #eee}
.stat-item:last-child{border:none}
.eur-text{color:var(--eur);font-weight:600}
.bgn-text{color:var(--bgn);font-weight:600}
.admin-toggle{position:fixed;bottom:4px;right:4px;opacity:.3;background:none;border:none;font-size:20px;cursor:pointer}
#adminPanel{display:none;position:fixed;inset:0;background:rgba(0,0,0,.9);color:#fff;padding:20px;z-index:100;overflow-y:auto}
#adminPanel h3{display:flex;justify-content:space-between}
#adminPanel button{background:#dc3545;color:#fff;width:100%;padding:10px;margin-top:10px}
@media print{body *{display:none}#print-receipt{display:block}}
#print-receipt{display:none;font-family:monospace;width:280px;margin:auto;color:#000}
#print-receipt .center{text-align:center}#print-receipt .line{border-top:1px dashed #000;margin:6px 0}
#print-receipt .total{font-size:20px;font-weight:bold;text-align:center;margin-top:8px}
</style>
</head>
<body>
<div class="container">
  <h2>üá™üá∫ –ï–≤—Ä–æ-–ö–∞—Å–∞ 2026</h2>
  <div class="info-banner">–ü–ª–∞—â–∞–Ω–µ—Ç–æ –º–æ–∂–µ –¥–∞ –µ –≤ –ª–µ–≤–∞ –∏/–∏–ª–∏ –µ–≤—Ä–æ. –†–µ—Å—Ç–æ—Ç–æ —Å–µ –≤—Ä—ä—â–∞ —Å–ø–æ—Ä–µ–¥ –∏–∑–±—Ä–∞–Ω–∏—è —Ä–µ–∂–∏–º.</div>

  <label class="eur-text">–°—É–º–∞ –∑–∞ –ø–ª–∞—â–∞–Ω–µ (EUR)</label>
  <input id="totalEUR" type="number" step="0.01" placeholder="0.00" class="eur-input">

  <div class="quick-calc">
    <!-- EUR –±–∞–Ω–∫–Ω–æ—Ç–∏ -->
    <button class="quick-btn eur" onclick="quick('eur',5)">5 ‚Ç¨</button>
    <button class="quick-btn eur" onclick="quick('eur',10)">10 ‚Ç¨</button>
    <button class="quick-btn eur" onclick="quick('eur',20)">20 ‚Ç¨</button>
    <button class="quick-btn eur" onclick="quick('eur',50)">50 ‚Ç¨</button>
    <button class="quick-btn eur" onclick="quick('eur',100)">100 ‚Ç¨</button>
    <button class="quick-btn eur" onclick="quick('eur',200)">200 ‚Ç¨</button>
    <!-- BGN –±–∞–Ω–∫–Ω–æ—Ç–∏ -->
    <button class="quick-btn bgn" onclick="quick('bgn',5)">5 –ª–≤</button>
    <button class="quick-btn bgn" onclick="quick('bgn',10)">10 –ª–≤</button>
    <button class="quick-btn bgn" onclick="quick('bgn',20)">20 –ª–≤</button>
    <button class="quick-btn bgn" onclick="quick('bgn',50)">50 –ª–≤</button>
    <button class="quick-btn bgn" onclick="quick('bgn',100)">100 –ª–≤</button>
    <button class="quick-btn bgn" onclick="quick('bgn',200)">200 –ª–≤</button>
  </div>

  <label class="bgn-text">–ü–ª–∞—Ç–µ–Ω–æ –≤ –ª–µ–≤–∞</label>
  <input id="givenBGN" type="number" step="0.01" placeholder="0.00" class="bgn-input">

  <label class="eur-text">–ü–ª–∞—Ç–µ–Ω–æ –≤ –µ–≤—Ä–æ</label>
  <input id="givenEUR" type="number" step="0.01" placeholder="0.00" class="eur-input">

  <div id="errorBanner" class="error-banner"></div>
  <div id="okBanner" class="ok-banner"></div>

  <div class="result-zone">
    <div style="font-size:12px">–†–ï–°–¢–û</div>
    <div id="restTotal" class="result-value">0.00</div>
    <div class="change-toggle">
      <button id="btnGiveEUR" class="active" onclick="setGiveMode('EUR')">–í—Ä—ä—â–∞–º –≤ ‚Ç¨</button>
      <button id="btnGiveBGN" onclick="setGiveMode('BGN')">–í—Ä—ä—â–∞–º –≤ –ª–≤</button>
      <button id="btnGiveMix" onclick="setGiveMode('MIX')">–°–º–µ—Å–µ–Ω–æ</button>
    </div>
    <div id="restDetail" class="bgn-text"></div>
  </div>

  <div class="stat-panel">
    <div class="stat-item"><span>–û–±–æ—Ä–æ—Ç –¥–Ω–µ—Å:</span><span class="eur-text"><span id="stEUR">0.00</span> ‚Ç¨</span></div>
    <div class="stat-item"><span>–ü–ª–∞—Ç–µ–Ω–æ –ª–µ–≤–∞:</span><span class="bgn-text"><span id="stBGN">0.00</span> –ª–≤</span></div>
    <div class="stat-item"><span>–ü–ª–∞—Ç–µ–Ω–æ –µ–≤—Ä–æ:</span><span class="eur-text"><span id="stPaidEUR">0.00</span> ‚Ç¨</span></div>
  </div>

  <div class="button-group">
    <button class="btn-save" onclick="saveOrder()">üíæ –ó–∞–ø–∏—Å</button>
    <button class="btn-print" onclick="printOrder()">üñ®Ô∏è –ü–µ—á–∞—Ç</button>
    <button class="btn-cancel" onclick="undoLast()">‚Ü© –û—Ç–º—è–Ω–∞</button>
  </div>

  <table class="history-table">
    <thead><tr><th>–î–∞—Ç–∞/–ß–∞—Å</th><th>–°—É–º–∞ ‚Ç¨</th><th>–ü–ª–∞—Ç–µ–Ω–æ ‚Ç¨</th><th>–ü–ª–∞—Ç–µ–Ω–æ –ª–≤</th><th>–†–µ—Å—Ç–æ</th></tr></thead>
    <tbody id="histBody"></tbody>
  </table>
</div>

<button class="admin-toggle" onclick="toggleAdmin()">‚öôÔ∏è</button>
<div id="adminPanel">
  <h3>–ê–¥–º–∏–Ω <button onclick="toggleAdmin()" style="background:none;color:#fff;border:none;font-size:20px;float:right">‚úñ</button></h3>
  <div style="background:#222;padding:12px;border-radius:8px">
    <div class="stat-item"><span>–û–±–æ—Ä–æ—Ç –¥–Ω–µ—Å (–ª–≤):</span><span style="color:var(--accent);font-size:18px" id="admLV">0.00</span></div>
    <button onclick="exportCSV()">üì• –ï–∫—Å–ø–æ—Ä—Ç CSV</button>
    <button onclick="clearDay()">üóë –ò–∑—Ç—Ä–∏–π –¥–µ–Ω—è</button>
  </div>
</div>

<div id="print-receipt">
  <div class="center"><strong>–°–¢–†–û–ò–¢–ï–õ–ï–ù –ú–ê–†–ö–ï–¢</strong></div>
  <div class="line"></div>
  <div>–û–ë–©–û: <span id="prTotal"></span> ‚Ç¨</div>
  <div>–ü–õ–ê–¢–ï–ù–û –õ–í: <span id="prBGN"></span> –ª–≤</div>
  <div>–ü–õ–ê–¢–ï–ù–û ‚Ç¨: <span id="prEUR"></span> ‚Ç¨</div>
  <div class="line"></div>
  <div class="total">–†–ï–°–¢–û: <span id="prRest"></span></div>
  <div class="line"></div>
  <div class="center">–ë–ª–∞–≥–æ–¥–∞—Ä–∏–º –í–∏!</div>
</div>

<script>
const RATE=1.95583;
let giveMode='EUR'; // EUR / BGN / MIX
let daily={totalEUR:0,paidBGN:0,paidEUR:0,ords:[]};
let todayKey='day_'+new Date().toISOString().slice(0,10);

/* ---------- –∑–≤—É–∫ ---------- */
const audioCtx=typeof AudioContext!=='undefined'?new AudioContext():new window.webkitAudioContext();
function beep(freq=600,ms=150){
  const o=audioCtx.createOscillator(),g=audioCtx.createGain();
  o.connect(g);g.connect(audioCtx.destination);
  o.frequency.value=freq;g.gain.value=0.2;
  o.start();o.stop(audioCtx.currentTime+ms/1000);
}
function okSound(){beep(900,120);}
function errSound(){beep(300,250);}

/* ---------- storage ---------- */
function load(){
  const s=localStorage.getItem(todayKey);
  if(s){daily=JSON.parse(s); refl();}
}
function save(){localStorage.setItem(todayKey,JSON.stringify(daily)); refl();}
load();

/* ---------- ui helpers ---------- */
function flashBanner(msg,isErr){
  const b=document.getElementById(isErr?'errorBanner':'okBanner');
  b.textContent=msg; b.style.display='block';
  setTimeout(()=>b.style.display='none',2500);
}
function refl(){
  document.getElementById('stEUR').textContent=daily.totalEUR.toFixed(2);
  document.getElementById('stBGN').textContent=daily.paidBGN.toFixed(2);
  document.getElementById('stPaidEUR').textContent=daily.paidEUR.toFixed(2);
  document.getElementById('admLV').textContent=(daily.totalEUR*RATE).toFixed(2);
  const hb=document.getElementById('histBody');
  hb.innerHTML=daily.ords.slice(-15).reverse().map(o=>
   `<tr><td>${o.time}</td><td class="eur-text">${o.eur.toFixed(2)}</td>
    <td class="eur-text">${o.pEur.toFixed(2)}</td>
    <td class="bgn-text">${o.bgn.toFixed(2)}</td>
    <td>${o.rest}</td></tr>`).join('');
}
function setGiveMode(m){
  giveMode=m;
  document.querySelectorAll('.change-toggle button').forEach(b=>b.classList.remove('active'));
  document.getElementById('btnGive'+m).classList.add('active');
  calc();
}

/* ---------- calc ---------- */
function calc(){
  const t=parseFloat(document.getElementById('totalEUR').value)||0;
  const gB=parseFloat(document.getElementById('givenBGN').value)||0;
  const gE=parseFloat(document.getElementById('givenEUR').value)||0;
  const paidE=gE+gB/RATE;
  const restE=paidE-t;
  const restB=restE*RATE;
  let restTxt='',detail='';
  if(restE<0){
    document.getElementById('restTotal').textContent='‚Äî';
    document.getElementById('restDetail').textContent='–ù–µ–¥–æ—Å—Ç–∞—Ç—ä—á–Ω–æ –ø–∞—Ä–∏!';
    document.getElementById('restTotal').style.color='#ffcccb';
    return null;
  }
  document.getElementById('restTotal').style.color='var(--accent)';
  if(giveMode==='EUR'){ restTxt=restE.toFixed(2)+' ‚Ç¨'; detail='('+restB.toFixed(2)+' –ª–≤)'; }
  else if(giveMode==='BGN'){ restTxt=restB.toFixed(2)+' –ª–≤'; detail='('+restE.toFixed(2)+' ‚Ç¨)'; }
  else { restTxt=restE.toFixed(2)+' ‚Ç¨ + '+restB.toFixed(2)+' –ª–≤'; }
  document.getElementById('restTotal').textContent=restTxt;
  document.getElementById('restDetail').textContent=detail;
  return {t,gB,gE,paidE,restE,restB};
}
document.querySelectorAll('input[type=number]').forEach(i=>i.addEventListener('input',calc));

/* ---------- quick ---------- */
function quick(c,v){
  const id=c==='eur'?'givenEUR':'givenBGN';
  const n=parseFloat(document.getElementById(id).value)||0;
  document.getElementById(id).value=(n+v).toFixed(2);
  calc();
}

/* ---------- order ---------- */
function validate(){
  const c=calc();
  if(!c){errSound(); flashBanner('–ù–µ–¥–æ—Å—Ç–∞—Ç—ä—á–Ω–æ –ø–∞—Ä–∏!',true); return false;}
  if(c.t<=0){errSound(); flashBanner('–í—ä–≤–µ–¥–∏ —Å—É–º–∞!',true); return false;}
  return c;
}
function saveOrder(){
  const c=validate(); if(!c) return;
  const now=new Date();
  const o={time:now.toLocaleString('bg-BG'),eur:c.t,pEur:c.gE,bgn:c.gB,
          rest:(giveMode==='EUR'?c.restE.toFixed(2)+' ‚Ç¨':
                giveMode==='BGN'?c.restB.toFixed(2)+' –ª–≤':
                c.restE.toFixed(2)+' ‚Ç¨ + '+c.restB.toFixed(2)+' –ª–≤')};
  daily.totalEUR+=c.t; daily.paidBGN+=c.gB; daily.paidEUR+=c.gE;
  daily.ords.push(o); save(); okSound(); flashBanner('–ü—Ä–æ–¥–∞–∂–±–∞—Ç–∞ –µ –∑–∞–ø–∏—Å–∞–Ω–∞!',false);
  clearInputs();
}
function clearInputs(){
  document.getElementById('totalEUR').value='';
  document.getElementById('givenBGN').value='';
  document.getElementById('givenEUR').value='';
  calc();
}
function printOrder(){
  const c=validate(); if(!c) return;
  if(!confirm('–ü–µ—á–∞—Ç –Ω–∞ –±–µ–ª–µ–∂–∫–∞?')) return;
  const r=giveMode==='EUR'?c.restE.toFixed(2)+' ‚Ç¨':
           giveMode==='BGN'?c.restB.toFixed(2)+' –ª–≤':
           c.restE.toFixed(2)+' ‚Ç¨ + '+c.restB.toFixed(2)+' –ª–≤';
  document.getElementById('prTotal').textContent=c.t.toFixed(2);
  document.getElementById('prBGN').textContent=c.gB.toFixed(2);
  document.getElementById('prEUR').textContent=c.gE.toFixed(2);
  document.getElementById('prRest').textContent=r;
  const w=window.open('','print','width=320,height=600');
  w.document.write('<html><head><title>–ë–û–ù</title></head><body>'+
    document.getElementById('print-receipt').innerHTML+'</body></html>');
  w.document.close(); w.focus(); w.print(); w.close();
  saveOrder(); // –∑–∞–ø–∏—Å–≤–∞ —Å–ª–µ–¥ –ø–µ—á–∞—Ç
}
function undoLast(){
  if(daily.ords.length===0){errSound(); flashBanner('–ù—è–º–∞ –∫–∞–∫–≤–æ –¥–∞ –æ—Ç–º–µ–Ω—è!',true); return;}
  const last=daily.ords.pop();
  daily.totalEUR-=last.eur; daily.paidBGN-=last.bgn; daily.paidEUR-=last.pEur;
  save(); okSound(); flashBanner('–ü–æ—Å–ª–µ–¥–Ω–∞—Ç–∞ –ø—Ä–æ–¥–∞–∂–±–∞ –µ –æ—Ç–º–µ–Ω–µ–Ω–∞!',false);
}
function toggleAdmin(){
  const p=document.getElementById('adminPanel');
  p.style.display=p.style.display==='block'?'none':'block';
}
function exportCSV(){
  let csv='–î–∞—Ç–∞,–°—É–º–∞ EUR,–ü–ª–∞—Ç–µ–Ω–æ EUR,–ü–ª–∞—Ç–µ–Ω–æ BGN,–†–µ—Å—Ç–æ\n';
  daily.ords.forEach(o=>csv+=`${o.time},${o.eur},${o.pEur},${o.bgn},"${o.rest}"\n`);
  const blob=new Blob([csv],{type:'text/csv;charset=utf-8;'});
  const a=document.createElement('a'),url=URL.createObjectURL(blob);
  a.href=url; a.download='sales_'+todayKey+'.csv'; a.click();
}
function clearDay(){
  if(!confirm('–ò–∑—Ç—Ä–∏–≤–∞–Ω–µ –Ω–∞ —Ü–µ–ª–∏—è –¥–µ–Ω?')) return;
  daily={totalEUR:0,paidBGN:0,paidEUR:0,ords:[]}; save(); refl();
  flashBanner('–î–µ–Ω—è—Ç –µ –∏–∑—Ç—Ä–∏—Ç!',false);
}
/* ---------- init ---------- */
calc();
</script>
</body>
</html>
