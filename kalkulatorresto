<!DOCTYPE html>
<html lang="bg">
<head>
<meta charset="UTF-8">
<title>–ï–≤—Ä–æ-–ö–∞—Å–∞ 2026</title>
<link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22 fill=%22%23d4af37%22>‚Ç¨</text></svg>">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<style>
:root{
  --primary:#00264d; --accent:#d4af37; --bg:#f2f2f2; --error:#dc3545; --ok:#28a745;
  --eur:#28a745; --bgn:#007bff;
  --font-size:22px; 
}
*{box-sizing:border-box; touch-action: manipulation;}
body{margin:0;font-family: 'Segoe UI', Arial, sans-serif;background:var(--bg);display:flex;justify-content:center;padding:10px}
.container{background:#fff;border-radius:16px;box-shadow:0 8px 30px rgba(0,0,0,.2);width:100%;max-width:600px;padding:20px}
.logo-circle { width: 70px; height: 70px; background: var(--primary); color: var(--accent); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 45px; font-weight: bold; margin: 0 auto 15px; border: 3px solid var(--accent); }
h2{margin:0 0 20px;text-align:center;color:var(--primary);font-size:28px; font-weight: 800; border-bottom: 3px solid var(--accent); padding-bottom: 10px;}
label{font-weight:700;font-size:14px;display:block;margin-bottom:6px;text-transform: uppercase;}
input[type=number],input[type=text]{width:100%;font-size:var(--font-size);padding:15px;border:2px solid #ccc;border-radius:8px;text-align:right;margin-bottom:12px;font-weight:bold;}
.eur-input{border-color:var(--eur);background:#fafffb}
.bgn-input{border-color:var(--bgn);background:#f5faff}
.bgn-hint { font-size: 16px; font-weight: bold; color: var(--bgn); margin-top: -10px; margin-bottom: 15px; text-align: right; }
#banknoteArea{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;margin-bottom:15px}
.money-btn{width:100%;padding:18px 5px;border:none;border-radius:8px;font-weight:bold;font-size:1.2rem;cursor:pointer;box-shadow: 0 2px 4px rgba(0,0,0,0.1)}
.eur-5{background:#b0bec5;} .eur-10{background:#ff8a80;} .eur-20{background:#90caf9;} 
.eur-50{background:#ffcc80;} .eur-100{background:#a5d6a7;} .eur-200{background:#e0e0e0;}
.bgn-5{background:#4fc3f7;} .bgn-10{background:#7986cb;} .bgn-20{background:#3f51b5;color:#fff;}
.bgn-50{background:#ffb74d;} .bgn-100{background:#e57373;}
.toggle-line{display:flex;justify-content:center;gap:10px;margin-bottom:15px}
.toggle-line button{flex:1;padding:12px;border:2px solid var(--primary);border-radius:8px;background:#fff;font-weight:700;cursor:pointer;font-size:14px}
.toggle-line button.active{background:var(--primary);color:#fff}
.result-zone{background:var(--primary);color:#fff;padding:20px;border-radius:12px;text-align:center;margin:15px 0; border: 2px solid var(--accent); transition: 0.3s;}
.result-value{font-size:44px;font-weight:bold;color:var(--accent);margin:5px 0}
#coinBreakdown { font-size: 14px; background: rgba(255,255,255,0.1); padding: 10px; border-radius: 8px; margin-top: 10px; text-align: left; display: none; line-height: 1.4; }
.change-toggle{display:flex;justify-content:center;gap:8px;margin:12px 0}
.change-toggle button{flex:1;padding:10px;border:1px solid #fff;border-radius:6px;background:transparent;color:#fff;font-weight:600;cursor:pointer;font-size:12px}
.change-toggle button.active{background:#fff;color:var(--primary)}
.button-group{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-top:15px}
button.action-btn{padding:18px;border:none;border-radius:8px;font-size:18px;font-weight:700;cursor:pointer;color:#fff; display:flex; align-items:center; justify-content:center; gap:8px}
.btn-save{background:var(--ok)} 
.btn-save:disabled {background:#666; cursor:not-allowed; opacity:0.6;}
.btn-print{background:var(--primary)}
.btn-clear{background:var(--error); grid-column: span 2; margin-top: 5px; padding: 10px; font-size: 14px;}
.history-table-container { overflow-x: auto; margin-top: 20px; }
.history-table{width:100%;font-size:12px;border-collapse:collapse; min-width: 400px;}
.history-table th,.history-table td{border:1px solid #ddd;padding:10px;text-align:center}
.history-table th{background:var(--primary);color:#fff}
#adminPanel{display:none;position:fixed;inset:0;background:rgba(0,0,0,.95);color:#fff;padding:30px;z-index:100;}

/* –°–¢–ò–õ –ó–ê –ü–ï–ß–ê–¢ –°–™–ì–õ–ê–°–ù–û –°–ù–ò–ú–ö–ê–¢–ê (20—Å–º —à–∏—Ä–∏–Ω–∞) */
@media print { 
    body * { visibility: hidden; } 
    #print-area, #print-area * { visibility: visible; } 
    #print-area { 
        position: absolute; 
        left: 0; 
        top: 0; 
        width: 195mm; 
        display: block !important; 
        padding: 5px; 
        font-size: 14px; 
        border: 1px solid #000;
        line-height: 1.3;
    } 
    .print-header { text-align: center; font-weight: bold; font-size: 16px; border-bottom: 1px solid #000; margin-bottom: 5px; }
    .print-row { display: flex; justify-content: space-between; margin-bottom: 3px; }
    @page { margin: 0.5cm; }
}
#print-area { display: none; }
</style>
</head>
<body>

<div class="container">
  <div class="logo-circle">‚Ç¨</div>
  <h2 id="storeTitle">–ö–ê–°–ê - 1</h2>

  <div class="toggle-line">
    <button id="toggleEUR" class="active" onclick="showBanknotes('EUR')">–ï–≤—Ä–æ –±–∞–Ω–∫–Ω–æ—Ç–∏</button>
    <button id="toggleBGN" onclick="showBanknotes('BGN')">–õ–µ–≤–∞ –±–∞–Ω–∫–Ω–æ—Ç–∏</button>
  </div>

  <div id="banknoteArea"></div>

  <label style="color:var(--eur)">–°—É–º–∞ –∑–∞ –ø–ª–∞—â–∞–Ω–µ (EUR)</label>
  <input id="totalEUR" type="number" inputmode="decimal" placeholder="0.00" class="eur-input" oninput="updateBgnHint()">
  <div id="bgnHint" class="bgn-hint">–†–∞–≤–Ω–æ—Å—Ç–æ–π–Ω–æ—Å—Ç: 0.00 –ª–≤</div>

  <label style="color:var(--bgn)">–ü–ª–∞—Ç–µ–Ω–æ –≤ –ª–µ–≤–∞ (BGN)</label>
  <input id="givenBGN" type="number" inputmode="decimal" placeholder="0.00" class="bgn-input" oninput="calculate()">

  <label style="color:var(--eur)">–ü–ª–∞—Ç–µ–Ω–æ –≤ –µ–≤—Ä–æ (EUR)</label>
  <input id="givenEUR" type="number" inputmode="decimal" placeholder="0.00" class="eur-input" oninput="calculate()">

  <div class="result-zone" id="resZone">
    <div style="font-size:14px; font-weight:bold; letter-spacing:1px">–†–ï–°–¢–û –ó–ê –í–†–™–©–ê–ù–ï</div>
    <div id="restTotal" class="result-value">0.00 ‚Ç¨</div>
    <div class="change-toggle">
      <button id="btnGiveEUR" class="active" onclick="setGiveMode('EUR')">–í—Ä—ä—â–∞–º –≤ ‚Ç¨</button>
      <button id="btnGiveBGN" onclick="setGiveMode('BGN')">–í—Ä—ä—â–∞–º –≤ –ª–≤</button>
      <button id="btnGiveMix" onclick="setGiveMode('MIX')">–°–º–µ—Å–µ–Ω–æ</button>
    </div>
    <div id="restDetail" style="color:var(--accent); font-weight:bold; margin-bottom:10px;">(0.00 –ª–≤)</div>
    <div id="coinBreakdown"></div>
  </div>

  <div class="button-group">
    <button id="btnSaveMain" class="action-btn btn-save" onclick="saveOrder()">üíæ –ó–∞–ø–∏—Å (Enter)</button>
    <button class="action-btn btn-print" onclick="printOrder()">üñ®Ô∏è –ü–µ—á–∞—Ç (P)</button>
    <button class="action-btn btn-clear" onclick="clearFields()">üóëÔ∏è –ò–∑—á–∏—Å—Ç–∏ –ø–æ–ª–µ—Ç–∞—Ç–∞</button>
  </div>

  <div class="history-table-container">
    <table class="history-table">
      <thead><tr><th>–ß–∞—Å</th><th>–°–º–µ—Ç–∫–∞ ‚Ç¨</th><th>–ü–ª–∞—Ç–µ–Ω–æ</th><th>–†–µ—Å—Ç–æ</th></tr></thead>
      <tbody id="histBody"></tbody>
    </table>
  </div>
</div>

<div id="print-area"></div>

<button style="position:fixed;bottom:10px;right:10px;opacity:.5;font-size:24px;background:none;border:none;" onclick="toggleAdmin()">‚öôÔ∏è</button>
<div id="adminPanel">
    <h3>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ <button onclick="toggleAdmin()" style="float:right">‚úñ</button></h3>
    <input id="storeNameInput" type="text" placeholder="–ò–º–µ –Ω–∞ –º–∞–≥–∞–∑–∏–Ω">
    <button onclick="saveSettings()" style="width:100%; padding:15px; background:var(--ok); color:#fff; border:none; border-radius:8px; font-weight:bold;">–ó–ê–ü–ê–ó–ò</button>
    <button onclick="clearHistory()" style="width:100%; padding:10px; background:var(--error); color:#fff; border:none; margin-top:20px;">–ò–∑—Ç—Ä–∏–π –∏—Å—Ç–æ—Ä–∏—è—Ç–∞</button>
</div>

<script>
const RATE = 1.95583;
const INV_RATE = 0.511292;
let giveMode = 'EUR';
let isDeficit = false;

document.addEventListener('keydown', function(e) {
    if (e.key === 'Enter') {
        e.preventDefault();
        saveOrder();
    } else if (e.key.toLowerCase() === 'p' || e.key.toLowerCase() === '–∑') {
        printOrder();
    }
});

function playImpressiveSound(type) {
    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    if (type === 'success') {
        [880, 1760].forEach((freq, i) => {
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.type = 'triangle';
            osc.frequency.setValueAtTime(freq, audioCtx.currentTime + (i * 0.1));
            gain.gain.setValueAtTime(0.2, audioCtx.currentTime + (i * 0.1));
            gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + (i * 0.1) + 0.2);
            osc.connect(gain); gain.connect(audioCtx.destination);
            osc.start(audioCtx.currentTime + (i * 0.1));
            osc.stop(audioCtx.currentTime + (i * 0.1) + 0.2);
        });
    } else if (type === 'error') {
        [0, 0.2].forEach(delay => {
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.type = 'sawtooth';
            osc.frequency.setValueAtTime(110, audioCtx.currentTime + delay); 
            gain.gain.setValueAtTime(0.15, audioCtx.currentTime + delay);
            gain.gain.linearRampToValueAtTime(0, audioCtx.currentTime + delay + 0.15);
            osc.connect(gain); gain.connect(audioCtx.destination);
            osc.start(audioCtx.currentTime + delay);
            osc.stop(audioCtx.currentTime + delay + 0.15);
        });
    }
}

window.onload = () => {
    const savedName = localStorage.getItem('euroKasa_storeName');
    if(savedName) { 
        document.getElementById('storeTitle').innerText = savedName; 
        document.getElementById('storeNameInput').value = savedName; 
    }
    loadHistory();
    showBanknotes('EUR');
    document.getElementById('totalEUR').focus();
};

function updateBgnHint() {
    const eur = parseFloat(document.getElementById('totalEUR').value) || 0;
    document.getElementById('bgnHint').innerText = `–†–∞–≤–Ω–æ—Å—Ç–æ–π–Ω–æ—Å—Ç: ${(eur * RATE).toFixed(2)} –ª–≤`;
    calculate();
}

function showBanknotes(currency) {
    const area = document.getElementById('banknoteArea');
    area.innerHTML = '';
    document.getElementById('toggleEUR').classList.toggle('active', currency==='EUR');
    document.getElementById('toggleBGN').classList.toggle('active', currency==='BGN');
    const notes = currency === 'EUR' ? [5, 10, 20, 50, 100, 200] : [5, 10, 20, 50, 100];
    notes.forEach(n => {
        const btn = document.createElement('button');
        btn.className = `money-btn ${currency.toLowerCase()}-${n}`;
        btn.innerText = n + (currency==='EUR' ? ' ‚Ç¨' : ' –ª–≤');
        btn.onclick = () => {
            const input = document.getElementById(currency === 'EUR' ? 'givenEUR' : 'givenBGN');
            input.value = (parseFloat(input.value || 0) + n).toFixed(2);
            calculate();
        };
        area.appendChild(btn);
    });
}

function setGiveMode(m) {
    giveMode = m;
    ['EUR','BGN','MIX'].forEach(x => document.getElementById('btnGive'+x).classList.toggle('active', m===x));
    calculate();
}

function calculate() {
    const totalEUR = parseFloat(document.getElementById('totalEUR').value) || 0;
    const paidEUR = parseFloat(document.getElementById('givenEUR').value) || 0;
    const paidBGN = parseFloat(document.getElementById('givenBGN').value) || 0;
    const totalPaidInEUR = paidEUR + (paidBGN / RATE);
    const restEUR = totalPaidInEUR - totalEUR;
    
    const resEl = document.getElementById('restTotal');
    const detEl = document.getElementById('restDetail');
    const breakEl = document.getElementById('coinBreakdown');
    const resZone = document.getElementById('resZone');
    const saveBtn = document.getElementById('btnSaveMain');
    
    if (restEUR < -0.001 && totalEUR > 0) {
        isDeficit = true;
        resEl.innerText = "–ù–ï–î–û–°–¢–ò–ì";
        detEl.innerText = (Math.abs(restEUR) * RATE).toFixed(2) + " –ª–≤";
        breakEl.style.display = 'none';
        resZone.style.boxShadow = "0 0 20px #dc3545";
        saveBtn.disabled = true;
        return;
    }

    isDeficit = false;
    saveBtn.disabled = false;
    resZone.style.boxShadow = "0 0 0px transparent";
    
    let displayRest = "0.00 ‚Ç¨";
    let subDetail = "(0.00 –ª–≤)";

    if (totalEUR > 0) {
        if(giveMode === 'EUR') {
            displayRest = restEUR.toFixed(2) + " ‚Ç¨";
            subDetail = "(" + (restEUR * RATE).toFixed(2) + " –ª–≤)";
            updateBreakdown(restEUR, 'EUR');
        } else if(giveMode === 'BGN') {
            displayRest = (restEUR * RATE).toFixed(2) + " –ª–≤";
            subDetail = "(" + restEUR.toFixed(2) + " ‚Ç¨)";
            updateBreakdown(restEUR * RATE, 'BGN');
        } else {
            const wholeEUR = Math.floor(restEUR + 0.0001);
            const centsEUR = restEUR - wholeEUR;
            displayRest = wholeEUR + " ‚Ç¨";
            subDetail = "+ " + (centsEUR * RATE).toFixed(2) + " –ª–≤";
            updateBreakdownMix(wholeEUR, centsEUR * RATE);
        }
    }

    resEl.innerText = displayRest;
    detEl.innerText = subDetail;
}

function updateBreakdown(amount, cur) {
    const el = document.getElementById('coinBreakdown');
    if (amount <= 0) { el.style.display = 'none'; return; }
    let denoms = [100, 50, 20, 10, 5, 2, 1, 0.50, 0.20, 0.10, 0.05, 0.02, 0.01];
    let result = "<strong>–ó–∞ –≤—Ä—ä—â–∞–Ω–µ:</strong><br>";
    let remaining = amount + 0.0001; 
    denoms.forEach(d => {
        let count = Math.floor(remaining / d);
        if (count > 0) {
            result += `${count} –±—Ä. x ${d.toFixed(2)} ${cur === 'EUR' ? '‚Ç¨' : '–ª–≤'}<br>`;
            remaining -= count * d;
            remaining = Math.round(remaining * 100) / 100;
        }
    });
    el.innerHTML = result; el.style.display = 'block';
}

function updateBreakdownMix(wholeEur, centsInBgn) {
    const el = document.getElementById('coinBreakdown');
    el.innerHTML = `<strong>–°–º–µ—Å–µ–Ω–æ:</strong> ${wholeEur} ‚Ç¨ + ${centsInBgn.toFixed(2)} –ª–≤`;
    el.style.display = 'block';
}

function saveOrder() {
    if (isDeficit) {
        playImpressiveSound('error');
        return;
    }
    const totalVal = parseFloat(document.getElementById('totalEUR').value);
    if (!totalVal || totalVal <= 0) return;

    playImpressiveSound('success');
    const order = {
        time: new Date().toLocaleTimeString('bg-BG'),
        date: new Date().toLocaleDateString('bg-BG'),
        total: document.getElementById('totalEUR').value + " ‚Ç¨",
        paid: `‚Ç¨:${document.getElementById('givenEUR').value || 0} / –ª–≤:${document.getElementById('givenBGN').value || 0}`,
        rest: document.getElementById('restTotal').innerText + " " + document.getElementById('restDetail').innerText
    };
    let history = JSON.parse(localStorage.getItem('euroKasa_history') || '[]');
    history.unshift(order);
    localStorage.setItem('euroKasa_history', JSON.stringify(history.slice(0, 50)));
    loadHistory();
    clearFields();
    document.getElementById('totalEUR').focus();
}

function loadHistory() {
    const history = JSON.parse(localStorage.getItem('euroKasa_history') || '[]');
    const body = document.getElementById('histBody');
    body.innerHTML = history.map(h => `<tr><td>${h.time}</td><td>${h.total}</td><td>${h.paid}</td><td>${h.rest}</td></tr>`).join('');
}

function printOrder() {
    const total = parseFloat(document.getElementById('totalEUR').value) || 0;
    if (total <= 0) return;
    const paidEUR = parseFloat(document.getElementById('givenEUR').value) || 0;
    const paidBGN = parseFloat(document.getElementById('givenBGN').value) || 0;
    const restTotal = document.getElementById('restTotal').innerText;
    const restLeva = document.getElementById('restDetail').innerText;
    
    const now = new Date();
    const dateStr = now.toLocaleDateString('bg-BG') + ' –≥.';
    const timeStr = now.toLocaleTimeString('bg-BG');

    document.getElementById('print-area').innerHTML = `
        <div class="print-header">–ò–ù–§–û–†–ú–ê–¶–ò–û–ù–ù–ê –ë–ï–õ–ï–ñ–ö–ê</div>
        <div class="print-row">
            <span><strong>–î–ê–¢–ê:</strong> ${dateStr}</span>
            <span><strong>—á–∞—Å:</strong> ${timeStr}</span>
        </div>
        <div class="print-row">
            <span><strong>–°—É–º–∞ –∑–∞ –ø–ª–∞—â–∞–Ω–µ –≤ –µ–≤—Ä–æ:</strong> ${total.toFixed(2)} –µ–≤—Ä–æ</span>
        </div>
        <div class="print-row">
            <span><strong>–ü–ª–∞—Ç–µ–Ω–æ –≤ –ª–µ–≤–∞:</strong> ${paidBGN.toFixed(2)} —Ä–∞–≤–Ω–æ—Å—Ç–æ–π–Ω–∞ ${(paidBGN * INV_RATE).toFixed(2)} –µ–≤—Ä–æ</span>
        </div>
        <div class="print-row">
            <span><strong>–†–µ—Å—Ç–æ –≤—ä—Ä–Ω–∞—Ç–æ –≤ –µ–≤—Ä–æ:</strong> ${restTotal} —Ä–∞–≤–Ω–æ—Å—Ç–æ–π–Ω–∞ ${restLeva}</span>
        </div>
        <div style="margin-top:5px; font-size: 12px;">
            –ö—É—Ä—Å –Ω–∞ –ë–ù–ë: 1 EUR = 1.95583 BGN<br>
            –û–±—Ä–∞—Ç–µ–Ω –∫—É—Ä—Å –Ω–∞ –ë–ù–ë: 1 BGN = 0.511292 EUR
        </div>
    `;
    window.print();
}

function clearFields() {
    document.getElementById('totalEUR').value = '';
    document.getElementById('givenBGN').value = '';
    document.getElementById('givenEUR').value = '';
    document.getElementById('resZone').style.boxShadow = "0 0 0px transparent";
    document.getElementById('coinBreakdown').style.display = 'none';
    updateBgnHint();
}

function toggleAdmin() {
    const p = document.getElementById('adminPanel');
    p.style.display = p.style.display === 'block' ? 'none' : 'block';
}

function saveSettings() {
    const newName = document.getElementById('storeNameInput').value;
    localStorage.setItem('euroKasa_storeName', newName);
    document.getElementById('storeTitle').innerText = newName;
    toggleAdmin();
}

function clearHistory() {
    if(confirm('–ò–∑—Ç—Ä–∏–≤–∞–Ω–µ –Ω–∞ –∏—Å—Ç–æ—Ä–∏—è—Ç–∞?')) { 
        localStorage.removeItem('euroKasa_history'); 
        loadHistory(); 
    }
}
</script>
</body>
</html>
